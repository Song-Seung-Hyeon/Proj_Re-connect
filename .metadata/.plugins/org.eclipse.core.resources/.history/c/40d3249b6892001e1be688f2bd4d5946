<%@ page import="javax.servlet.http.*,java.io.*,java.sql.*"%>
<%@ page import="java.sql.*, java.io.*"%>
<%@ page contentType="text/html;charset=UTF-8" language="java"%>
<%@ page import="javax.servlet.http.HttpSession"%>
<%
request.setCharacterEncoding("utf-8");
%>

<%
// JDBC 드라이버 로드
Class.forName("com.mysql.jdbc.Driver");

// MySQL 데이터베이스 연결 정보
String url = "jdbc:mysql://localhost:3306/recycle";
String username = "root";
String password = "znfntbt0!";

// 데이터베이스 연결
Connection conn = null;
Statement stmt = null;
ResultSet rs = null;

try {
    conn = DriverManager.getConnection(url, username, password);
    stmt = conn.createStatement();
    rs = stmt.executeQuery("SELECT * FROM user_list");

    // JavaScript 배열로 데이터 가공
    StringBuilder data = new StringBuilder("var wordCloudData = [");

    while (rs.next()) {
        String userName = rs.getString("user_name");
        // JavaScript 배열에 해당 값을 추가
        data.append("{ x: \"").append(userName).append("\", value: 5 },");
    }

    // 마지막 쉼표 제거 후 JavaScript 배열 닫기
    if (data.charAt(data.length() - 1) == ',') {
        data.deleteCharAt(data.length() - 1);
    }
    data.append("];");

    // JavaScript로 데이터 출력
    System.out.println(data);

} catch (SQLException e) {
    e.printStackTrace();
} finally {
    // 리소스 닫기
    if (rs != null) {
        try {
            rs.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    if (stmt != null) {
        try {
            stmt.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    if (conn != null) {
        try {
            conn.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
%>
